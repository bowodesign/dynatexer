(function(a){function c(a,b){var c=b||typeof b==="undefined"?"<br />":"<br>";return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+c)}function d(b,c){if(!b.placeholder_tag){if(!b.placeholder||b.placeholder==""){b.placeholder_tag=target}else{placeholder_tag=a(b.placeholder);if(c.cursor&&c.cursor.placeholder_tag){b.placeholder_tag=placeholder_tag;b.placeholder_tag.insertBefore(c.cursor.placeholder_tag)}else{b.placeholder_tag=placeholder_tag;c.target.append(b.placeholder_tag)}}}}function e(a){if(!a.current_iterator){a.current_iterator=l[a.render_strategy](a.items)}}function f(a){this.current_char=0;this.text=a}function g(a){this.listed=false;this.text=a}function h(a){this.current_item=0;this.items=a}function i(a){lines=a.match(/^.*((\r\n|\n|\r)|$)/gm);this.delegate=new h(lines)}function j(a,b,c,d){d.prepare();c=typeof c==="undefined"?function(){}:c;e(b);b.current_iterator.has_next()?animated=true:animated=false;var f=function(){if(a.running){if(b.current_iterator.has_next()){d.render();setTimeout(function(){if(a.running){f()}},b.delay)}else{c()}}};setTimeout(function(){f()},1);return animated}function m(b){a.each(b.content,function(a,b){b.current_iterator=null;b.placeholder_tag=null});b.current_content=0;if(b.cursor){b.target.children().not(b.cursor.placeholder_tag).remove()}else{b.target.children().remove()}}function n(a){if(a.cursor){a.cursor.current_iterator=null;if(a.cursor.placeholder_tag){a.cursor.placeholder_tag.children().remove();a.cursor.placeholder_tag.text("")}}}function o(c){c=a.extend({},a.fn[b].defaults.general,c);content=[];a.each(c.content,function(c,d){content.push(a.extend({},a.fn[b].defaults.content,d))});c.content=content;if(typeof c.cursor!="undefined"){c.cursor=a.extend({},a.fn[b].defaults.cursor,c.cursor)}return c}function p(a,c){c=o(c);data=a.data(b);if(!data){a.data(b,{target:a})}data=a.data(b);data.loop=c.loop;data.content=c.content;data.current_content=0;data.times=0;data.running=false;data.cursor=c.cursor;if(typeof data.cursor!="undefined"){if(typeof data.cursor.placeholder=="undefined"||data.cursor.placeholder==""){data.cursor.placeholder="<span>"}data.cursor.times=0}}var b="dynatexer";f.prototype.has_next=function(){return this.current_char<this.text.length};f.prototype.next=function(){char=this.text.charAt(this.current_char++);if(char=="\r"){char=content.text.charAt(this.current_item++)}if(char=="\n"){char="<br />"}return char};g.prototype.has_next=function(){return!this.listed};g.prototype.next=function(){this.listed=true;return c(this.text)};h.prototype.has_next=function(){return this.current_item<this.items.length};h.prototype.next=function(){return this.items[this.current_item++]};i.prototype.has_next=function(){return this.delegate.has_next()};i.prototype.next=function(){return this.delegate.next()+"<br />"};var k={additive:function(a,b,c){return j(a,b,c,{prepare:function(){d(b,a)},render:function(){b.placeholder_tag.html(b.placeholder_tag.html()+b.current_iterator.next())}})},replace:function(a,b,c){return j(a,b,c,{prepare:function(){if(!b.placeholder||b.placeholder=="")b.placeholder="<span>";d(b,a)},render:function(){b.placeholder_tag.html(b.current_iterator.next())}})}};var l={"text-by-char":function(a){return new f(a.toString())},"text-by-line":function(a){return new i(a.toString())},"text-one-shot":function(a){return new g(a.toString())},iterator:function(a){return a.iterator()},"array-items":function(a){return new h(a)}};var q={init:function(b){return this.each(function(){p(a(this),b)})},play:function(c){c=typeof c==="undefined"?function(){}:c;return this.each(function(){var d=a(this),e=d.data(b);if(e.running)return;e.running=true;var f=function(){if(e.running){if(e.current_content<e.content.length){content=e.content[e.current_content];k[content.animation](e,content,function(){++e.current_content;f()})}else{if(e.loop=="infinite"||e.loop<1){m(e);f()}else{++e.times;if(e.times<e.loop){m(e);f()}else{e.running=false;c()}}}}};f();var g=function(){if(e.running&&e.cursor){k[e.cursor.animation](e,e.cursor,function(){if(e.cursor.loop=="infinite"||e.cursor.loop<1){n(e);g()}else{++e.cursor.times;if(e.cursor.times<e.cursor.loop){n(e);g()}}})}};g()})},pause:function(){return this.each(function(){var c=a(this),d=c.data(b);d.running=false})},reset:function(){return this.each(function(){var c=a(this),d=c.data(b);d.running=false;d.times=0;if(typeof d.cursor!="undefined"){d.cursor.times=0}m(d);n(d)})},configure:function(c){return this.each(function(){var d=a(this),e=d.data(b);m(e);e.target.children().remove();p(d,c)})}};a.fn[b]=function(c){if(q[c]){return q[c].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof c==="object"||!c){return q.init.apply(this,arguments)}else{a.error("Method "+c+" does not exist on jQuery."+b)}};a.fn[b].defaults={general:{loop:1,content:[]},content:{animation:"additive",delay:0,placeholder:"<span>",render_strategy:"text-one-shot",items:""},cursor:{loop:"infinite",animation:"replace",delay:500,placeholder:"<span>",render_strategy:"array-items",items:[]}};a.fn[b].helper={counter:function(b){return{iterator:function(){it={config:a.extend({start:1,end:100,step:1,mask:"%d"},b),has_next:function(){return this.index<=this.config.end},next:function(){temp=this.index;this.index+=this.config.step;return this.config.mask.replace("%d",temp)}};it.index=it.config.start;return it}}}}})(jQuery)
